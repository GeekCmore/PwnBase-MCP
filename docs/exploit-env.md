# exploit-env — Container Reference

This document describes the exploit-env container's contents, build requirements, and internal structure. Step documents will direct you here at the appropriate moments.

---

## Purpose

exploit-env is the Agent's working environment. It hosts:
- The MCP HTTP server (the only interface the Agent uses)
- A persistent Python interpreter with pwntools
- pwndbg for binary debugging
- HTTP proxies to challenge-env and pyghidra-mcp

---

## Dockerfile Requirements

Base image: `ubuntu:22.04`

### System packages to install:
```
python3 python3-pip python3-dev
gdb
git
curl wget
build-essential
procps               # for /proc utilities
```

### GDB/pwndbg setup:
```dockerfile
RUN git clone https://github.com/pwndbg/pwndbg /opt/pwndbg \
 && cd /opt/pwndbg && ./setup.sh
```

pwndbg's `setup.sh` installs itself as a gdb extension. After this, running `gdb` will automatically load pwndbg.

### Python environment via uv:
```dockerfile
# Install uv
RUN curl -LsSf https://astral.sh/uv/install.sh | sh
ENV PATH="/root/.cargo/bin:/root/.local/bin:$PATH"

# Copy project files
COPY pyproject.toml /app/pyproject.toml
COPY mcp_server/    /app/mcp_server/

WORKDIR /app

# Install dependencies
RUN uv sync
```

### Entrypoint:
```dockerfile
EXPOSE 8080
CMD ["uv", "run", "python", "-m", "mcp_server.main"]
```

---

## pyproject.toml

Located at `exploit-env/pyproject.toml`. Defines the Python project and all dependencies:

```toml
[project]
name = "pwn-agent-mcp"
version = "0.1.0"
requires-python = ">=3.11"
dependencies = [
    "pwntools>=4.12.0",
    "mcp[cli]>=1.0.0",
    "httpx>=0.27.0",
    "flask>=3.0.0",
]

[project.optional-dependencies]
test = [
    "pytest>=8.0.0",
    "pytest-asyncio>=0.23.0",
    "pytest-mock>=3.12.0",
]

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[tool.pytest.ini_options]
asyncio_mode = "auto"
testpaths = ["tests"]
```

---

## Volume Mounts

| Host path | Container path | Mode |
|-----------|----------------|------|
| `./challenges` | `/challenges` | read-only |

The `/challenges` volume is mounted read-only so that ghidra_proxy.py can pass binary paths to pyghidra-mcp and so that integration tests can reference challenge files.

---

## Environment Variables

| Variable | Default | Purpose |
|----------|---------|---------|
| `PYGHIDRA_MCP_URL` | `http://pyghidra-mcp:9090` | Internal URL for pyghidra-mcp |
| `MCP_PORT` | `8080` | Port the MCP server listens on |

---

## PID Namespace

exploit-env requires **no special configuration** for PID sharing. It starts normally. challenge-env is configured to join exploit-env's namespace via `pid: "service:exploit-env"` in docker-compose. The only requirement is that exploit-env starts before challenge-env, which is enforced by `depends_on`.

After challenge-env joins the namespace, all challenge processes appear in `/proc` as seen from exploit-env. `gdb attach <pid>` works without any additional privileges.

---

## Internal Network

All three containers share a Docker bridge network (default compose network). exploit-env reaches pyghidra-mcp at `http://pyghidra-mcp:9090` using Docker's internal DNS. This URL is never exposed to the host.

---

## Directory Structure Inside Container

```
/app/
├── pyproject.toml
└── mcp_server/
    ├── __init__.py
    ├── main.py
    ├── session.py
    ├── block_registry.py
    ├── execution_engine.py
    ├── interpreter.py
    ├── gdb_controller.py
    ├── proc_utils.py
    ├── challenge_client.py
    └── ghidra_proxy.py
/challenges/               ← mounted read-only from host
/opt/pwndbg/               ← pwndbg installation
```
